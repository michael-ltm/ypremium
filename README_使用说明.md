# YouTube Smart Replace 使用说明

YouTube Premium 印度区价格显示工具，通过中间人代理修改请求/响应实现区域切换。

---

## 目录

1. [系统要求](#系统要求)
2. [文件说明](#文件说明)
3. [快速开始](#快速开始)
4. [详细配置](#详细配置)
   - [安装 mitmproxy 证书](#1-安装-mitmproxy-证书)
   - [配置上游代理](#2-配置上游代理)
   - [配置浏览器代理](#3-配置浏览器代理)
5. [使用方法](#使用方法)
6. [常见问题](#常见问题)
7. [故障排除](#故障排除)

---

## 系统要求

- **操作系统**: Windows 10/11 (x64)
- **上游代理**: Clash/V2Ray/SSR 等代理软件，需能访问外网
- **浏览器**: Chrome/Edge/Firefox（推荐 Chrome）

---

## 文件说明

| 文件 | 说明 |
|------|------|
| `YouTubeSmartReplace.exe` | 主程序 |
| `india.md` | 印度区响应模板（必须与 exe 同目录） |
| `README_使用说明.md` | 本说明文档 |

---

## 快速开始

```
┌─────────────────────────────────────────────────────────────┐
│  浏览器  ──►  本工具 (8080)  ──►  Clash (7897)  ──►  外网   │
└─────────────────────────────────────────────────────────────┘
```

**简要步骤：**

1. 确保 Clash/V2Ray 运行在 `127.0.0.1:7897`
2. 运行 `YouTubeSmartReplace.exe`
3. 安装 mitmproxy 证书（首次需要）
4. 设置浏览器代理为 `127.0.0.1:8080`
5. 访问 YouTube Premium 页面

---

## 详细配置

### 1. 安装 mitmproxy 证书

mitmproxy 需要安装 CA 证书才能解密 HTTPS 流量。**这是必须步骤！**

#### Windows 系统证书安装

**方法一：自动安装（推荐）**

1. 运行 `YouTubeSmartReplace.exe`
2. 设置浏览器代理为 `127.0.0.1:8080`
3. 浏览器访问 [http://mitm.it](http://mitm.it)
4. 点击 **Windows** 图标下载证书
5. 双击下载的 `mitmproxy-ca-cert.p12` 文件
6. 按向导安装：
   - 存储位置选择 **当前用户**
   - 密码留空，直接下一步
   - 证书存储选择 **受信任的根证书颁发机构**
   - 完成安装

**方法二：手动安装**

证书文件位置（首次运行后生成）：
```
C:\Users\<用户名>\.mitmproxy\mitmproxy-ca-cert.cer
```

1. 找到上述证书文件
2. 双击打开 → 安装证书
3. 选择"本地计算机"或"当前用户"
4. 选择"将所有证书放入下列存储"
5. 点击"浏览"，选择"受信任的根证书颁发机构"
6. 完成安装

#### Chrome/Edge 浏览器

Chrome 和 Edge 使用系统证书，按上述方法安装即可。

#### Firefox 浏览器

Firefox 使用独立证书存储，需要单独导入：

1. 打开 Firefox → 设置 → 隐私与安全
2. 滚动到"证书"部分 → 点击"查看证书"
3. 切换到"证书颁发机构"标签
4. 点击"导入" → 选择 `mitmproxy-ca-cert.cer`
5. 勾选"信任此 CA 以标识网站"
6. 确定

#### 验证证书安装

1. 确保 YouTubeSmartReplace.exe 正在运行
2. 设置好浏览器代理
3. 访问 [https://www.youtube.com](https://www.youtube.com)
4. 如果没有证书警告，说明安装成功

---

### 2. 配置上游代理

本工具需要一个上游代理来访问外网。默认配置为 `127.0.0.1:7897`。

#### Clash 配置

1. 打开 Clash
2. 确认 HTTP 代理端口为 `7897`
   - 常见端口：7890（混合）、7897（HTTP）
3. 如果端口不同，需要修改源码重新编译

#### V2Ray/V2RayN 配置

1. 打开 V2RayN
2. 设置 → 参数设置 → Core:基础设置
3. 确认本地监听端口（HTTP 代理端口）
4. 如果不是 7897，需要修改

#### 其他代理软件

确保有一个 HTTP 代理监听在 `127.0.0.1:7897`。

---

### 3. 配置浏览器代理

需要将浏览器的代理设置为本工具的监听地址 `127.0.0.1:8080`。

#### 方法一：使用代理扩展（推荐）

推荐使用 **SwitchyOmega** 扩展（Chrome/Edge/Firefox 都支持）。

1. 安装 SwitchyOmega 扩展
2. 新建情景模式，类型选"代理服务器"
3. 配置：
   - 代理协议：HTTP
   - 代理服务器：127.0.0.1
   - 代理端口：8080
4. 保存并应用

#### 方法二：系统代理设置

**Windows 10/11：**

1. 设置 → 网络和 Internet → 代理
2. 手动设置代理：
   - 开启"使用代理服务器"
   - 地址：`127.0.0.1`
   - 端口：`8080`
3. 保存

**注意：** 系统代理会影响所有应用，使用完毕后记得关闭。

---

## 使用方法

### 启动步骤

1. **启动上游代理**
   - 确保 Clash/V2Ray 正在运行
   - 确认代理端口为 7897

2. **启动本工具**
   ```
   双击运行 YouTubeSmartReplace.exe
   ```
   看到以下信息表示启动成功：
   ```
   ============================================================
   YouTube Smart Replace v1.0
   ============================================================
   上游代理: http://127.0.0.1:7897
   监听地址: 127.0.0.1:8080
   ============================================================
   [成功] 已加载印度响应模板
   ```

3. **设置浏览器代理**
   - 使用 SwitchyOmega 或系统代理
   - 设置为 `127.0.0.1:8080`

4. **访问 YouTube**
   - 打开 [https://www.youtube.com/premium](https://www.youtube.com/premium)
   - 应该能看到印度区价格（₹）

### 停止步骤

1. 在 exe 窗口按 `Ctrl + C`
2. 关闭浏览器代理（切回直连或 Clash）

---

## 常见问题

### Q: 为什么需要安装证书？

A: YouTube 使用 HTTPS 加密。本工具需要解密流量才能修改响应内容，因此需要安装 mitmproxy 的 CA 证书。证书只在本地使用，不会泄露任何信息。

### Q: 安装证书安全吗？

A: 
- 证书仅在本地生成和使用
- 仅在使用本工具时启用代理
- 用完后可以删除证书
- 不建议长期保留证书

### Q: 为什么选择印度区？

A: 印度区 YouTube Premium 价格最低，家庭方案约 ₹189/月（约 ¥16）。

### Q: 支付会有问题吗？

A: 本工具仅修改页面显示，实际支付取决于你的支付方式（需要印度支付方式）。

### Q: 端口 7897 被占用怎么办？

A: 需要修改源码中的端口配置后重新打包，或者修改 Clash 端口为 7897。

### Q: 端口 8080 被占用怎么办？

A: 同上，需要修改源码中的 `LISTEN_PORT` 配置。

---

## 故障排除

### 问题：证书错误/不安全警告

**原因：** mitmproxy 证书未正确安装

**解决：**
1. 检查证书是否安装到"受信任的根证书颁发机构"
2. 重启浏览器
3. 清除浏览器缓存
4. 重新按照证书安装步骤操作

### 问题：无法连接/超时

**原因：** 上游代理未运行或端口错误

**解决：**
1. 确认 Clash/V2Ray 正在运行
2. 确认代理端口为 7897
3. 测试：直接设置浏览器代理为 Clash 端口，看能否上网

### 问题：页面显示 "couldn't verify your location"

**原因：** 这正是本工具要解决的问题

**解决：**
1. 确认 YouTubeSmartReplace.exe 正在运行
2. 确认浏览器代理设置为 8080
3. 查看 exe 窗口是否有 `[检测到]` 和 `[成功]` 日志
4. 确认 india.md 文件存在且与 exe 同目录

### 问题：exe 闪退

**原因：** 可能缺少依赖或 india.md 文件

**解决：**
1. 确认 india.md 与 exe 在同一目录
2. 尝试在命令提示符中运行 exe 查看错误信息
3. 检查是否有杀毒软件拦截

### 问题：价格仍显示本地货币

**原因：** 可能缓存问题或替换未生效

**解决：**
1. 清除浏览器缓存和 Cookie
2. 使用隐私/无痕模式访问
3. 查看 exe 窗口日志确认是否有替换操作

---

## 调试文件

程序运行时会在 exe 同目录生成调试文件：

| 文件 | 说明 |
|------|------|
| `debug_merged.json` | 合并后的响应数据 |
| `debug_payment.json` | 支付相关响应 |
| `debug_payment_request.txt` | 支付请求详情 |

如遇问题，可检查这些文件辅助排查。

---

## 注意事项

1. **仅供学习研究使用**
2. **使用完毕后建议：**
   - 关闭浏览器代理
   - 删除 mitmproxy 证书
   - 清除浏览器缓存
3. **本工具不保证支付成功**
4. **请遵守当地法律法规**

---

## 技术架构

```
┌─────────────┐     ┌──────────────────────┐     ┌─────────────┐
│   浏览器    │────►│  YouTubeSmartReplace │────►│ Clash/V2Ray │
│             │◄────│     (mitmproxy)      │◄────│   (7897)    │
│  代理:8080  │     │    监听端口:8080     │     │             │
└─────────────┘     └──────────────────────┘     └─────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │ 修改请求/响应：  │
                    │ - 区域 → IN      │
                    │ - 语言 → en-IN   │
                    │ - 时区 → 印度    │
                    │ - 价格 → 印度卢比│
                    └──────────────────┘
```

---

**版本：** 1.0  
**更新日期：** 2024
